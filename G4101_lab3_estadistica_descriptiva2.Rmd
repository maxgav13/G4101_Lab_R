---
title: "Lab 3: Estadistica Descriptiva 2"
author: "Maximiliano Garnier Villarreal"
output:
  html_document:
    df_print: paged
    highlight: textmate
    keep_md: yes
    number_sections: yes
    theme: spacelab
    toc: yes
  word_document:
    toc: yes
  pdf_document:
    df_print: kable
    keep_tex: yes
    number_sections: yes
    toc: yes
  html_notebook:
    highlight: pygments
    number_sections: yes
    theme: flatly
    toc: yes
always_allow_html: yes
---

# Estadistica descriptiva

```{r setup, include=FALSE, warning=F, message=FALSE}
library(DescTools)
library(janitor)
library(highcharter)
library(tidymodels)
library(tidyverse)
library(easystats)
library(rio)

theme_set(theme_minimal(base_size = 12))

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  # fig.path = "figs/",
  fig.retina = 3,
  fig.width = 8,
  fig.asp = 0.618,
  fig.align = "center",
  out.width = "90%"
)
```


Vamos a usar los datos de `airquality`.

```{r}
airq = airquality %>% 
  as_tibble() %>% 
  mutate(Month = as_factor(Month),
         Day = as_factor(Day)) %>% 
  sjmisc::std_if(is.numeric) %>% 
  # sjmisc::center_if(is.numeric)
  mutate(across(.cols = where(is.numeric) & !ends_with(c('_z')),
                # .cols = 1:4,
                .fns = ~ .x - mean(.x, na.rm = T),
                .names = '{.col}_c'))
airq

airq2 = airq %>% 
  select(where(is.numeric) & !ends_with(c('_c','_z')))
airq2
```

## Bivariable

Las funciones covarianza (`cov`) y correlacion (`cor`) pueden actuar sobre vectores o sobre DataFrames. En estos ultimos el resultado va a ser una matriz de covarianza o correlacion, en su mayoria se requiere que el DataFrame sea numerico, sin columnas de texto o factores.

```{r}
x = airq$Solar.R
y = airq$Temp

cov(x,y,use = 'pairwise.complete.obs') # covarianza
cor(x,y,method = "pearson",
    use = 'pairwise.complete.obs') # coeficiente de correlacion de Pearson

cov(airq2, use = 'pairwise.complete.obs') # matriz de varianza-covarianza
cor(airq2, use = 'pairwise.complete.obs') # matriz de correlacion de Pearson

corrr::correlate(airq2, diagonal = 1, 
                 method = 'pearson')

correlation(airq2, method = 'pearson')

# grafico estatico de coeficientes de correlacion

GGally::ggcorr(airq2, label = T,
               label_round = 2,
               label_size = 4,
               method = c('pairwise.complete.obs','pearson')) 

ggstatsplot::ggcorrmat(airq2)
```

El siguiente codigo genera un grafico interactivo de la matriz de correlacion (Solo se despliega en formato HTML).

```{r eval=knitr::is_html_output()}
hchart(cor(airq2,use = 'pairwise.complete.obs')) # grafico interactivo de coeficientes de correlacion
```

## Regresion

Para presentar caracteristicas de los modelos de forma mas estetica y ordenada se pueden usar las funciones `tidy` y `glance` del paquete *broom*, o `model_parameter` y `model_performance` de los paquetes *parameters* y *performance*. `tidy` y `model_parameter` genera la tabla resumen de los coeficientes y sus estadisticas, mientras que `glance` y `model_performance` genera una tabla con medidas de ajuste, incluyendo el $R^2$.

### Relacion entre correlacion y regresion simple

```{r}
lm(Temp_z ~ Wind_z, data = airq) %>% tidy()

lm(Temp ~ Wind, data = airq) %>% 
  standardize_parameters(method = 'refit')

with(airq, cor(Temp_z, Wind_z))
```


### Lineal

$y \thicksim \hat{b}_0 + \hat{b}_1x + \epsilon$

```{r}
mod1 = lm(Temp ~ Solar.R, data = airq) # modelo de regresion lineal

mod1 %>% tidy()
mod1 %>% model_parameters()

mod1 %>% glance()
mod1 %>% model_performance()

sjstats::cv(mod1) # cv

# graficos diagnostico
# plot(mod1) # graficos diagnostico
check_model(mod1,panel=F)
```

### Cuadratica

$y \thicksim \hat{b}_0 + \hat{b}_1x + \hat{b}_2x^2 + \epsilon$

```{r}
mod2 = lm(Temp ~ Solar.R + I(Solar.R^2), data = airq) # modelo de regresion cuadratica

mod2 %>% tidy()
mod2 %>% model_parameters()

mod2 %>% glance()
mod2 %>% model_performance()

sjstats::cv(mod2) # cv

# graficos diagnostico
# plot(mod2) 
check_model(mod2,panel=F)
```

### Compara modelos

```{r}
TMod(mod1,mod2) # DescTools

modelsummary::modelsummary(list(Lineal=mod1,Cuadratico=mod2),
                           statistic = NULL, # 'conf.int',
                           coef_omit = NULL, # 'Int'
                           stars = F,
                           fmt = 4)

sjPlot::tab_model(mod1,mod2,
                  title = 'Comparasion de modelos',
                  show.std = NULL, # 'std', NULL
                  show.intercept = T,
                  show.ci = F, # .95
                  collapse.ci = F,
                  ci.hyphen = ' , ',
                  show.stat = F,
                  show.p = F,
                  show.aic = T,
                  dv.labels = c('Lineal','Cuadr√°tico'),
                  digits = 4)

comp.mods = compare_performance(mod1,mod2,rank = T) # performance
comp.mods
plot(comp.mods)
```

## Graficos

Para agregar lineas de tendencia en *ggplot2* se usa la funcion `geom_smooth`. Por defecto ajusta una curva loess, pero para cambiarlo se usa `method = 'lm'`, y para especificar una ecuacion diferente a la regresion simple se usa `formula`, donde `y` y `x` son genericos, **NO** hay que poner el nombre de las variables que se esta graficando.

```{r}
ggplot(airq, aes(Solar.R,Temp)) + 
  geom_point()

ggplot(airq, aes(Solar.R,Temp)) + 
  geom_point() + 
  geom_smooth()

# grafico regresion lineal
ggplot(airq, aes(Solar.R,Temp)) + 
  geom_point() + 
  geom_smooth(method = 'lm')

# grafico regresion cuadratica
ggplot(airq, aes(Solar.R,Temp)) + 
  geom_point() + 
  geom_smooth(method = 'lm', formula = y~poly(x, 2))

# grafico regresion lineal y cuadratica
ggplot(airq, aes(Solar.R,Temp)) + 
  geom_point() + 
  geom_smooth(method = 'lm', aes(col='Lineal')) + 
  geom_smooth(method = 'lm', aes(col='Cuadratico'), 
              formula = y~poly(x, 2)) +
  scale_color_brewer('Modelo',palette = 'Dark2')
```


# Probabilidad

```{r}
A = matrix(data = c(15,24,23,14,11,13),nrow = 2)
colnames(A) = c('A','B','C')
row.names(A) = c('X','Y')
PercTable(A)
PercTable(A, margins = c(1,2))
```

